{# apps/adminx/templates/adminx/subscriptions.html 승인 내용을 자동승인/수동승인으로 변경시 탭 수정 #} 
{% extends "base.html" %}{% block title %}{{ title }}{% endblock %}
{% block content %}
<h1 class="mb-4">AI 서비스 구독 승인 관리</h1>
<ul class="nav nav-tabs mb-4" id="subscriptionTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">
            승인 대기 ({{ pending_subscriptions|length }})
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab" aria-controls="approved" aria-selected="false">
            승인됨 ({{ approved_subscriptions|length }})
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab" aria-controls="rejected" aria-selected="false">
            거부됨 ({{ rejected_subscriptions|length }})
        </button>
    </li>
</ul>
<div class="tab-content" id="subscriptionTabsContent">
    <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
        <h2>승인 대기 중인 요청</h2>
        {% if pending_subscriptions %}
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead class="table-warning text-dark">
                    <tr>
                        <th scope="col">사용자</th>
                        <th scope="col">서비스</th>
                        <th scope="col">활성화</th>
                        <th scope="col">신청일</th>
                        <th scope="col">동작</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sub in pending_subscriptions %}
                    <tr>
                        <td>{{ sub.user.username }} ({{sub.user.email}})</td>
                        <td>{{ sub.service.servicename }}</td>
                        <td>{{ sub.service.is_active }}</td>
                        <td>{{ sub.request_date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('adminx.manage_subscription', sub_id=sub.id, action='approve') }}" style="display:inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-success btn-sm" onclick="return confirm('이 구독을 승인하시겠습니까?');">승인</button>
                            </form>
                            <form method="POST" action="{{ url_for('adminx.manage_subscription', sub_id=sub.id, action='reject') }}" style="display:inline;" class="ms-1">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('이 구독을 거부하시겠습니까?');">거부</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info" role="alert">현재 승인 대기 중인 구독 요청이 없습니다.</div>
        {% endif %}
    </div>
    <div class="tab-pane fade" id="approved" role="tabpanel" aria-labelledby="approved-tab">
        <h2>승인된 구독</h2>
        {% if approved_subscriptions %}
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead class="table-success">
                    <tr>
                        <th scope="col">사용자</th>
                        <th scope="col">서비스</th>
                        <th scope="col">신청일</th>
                        <th scope="col">승인일</th>
                        <th scope="col">동작</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sub in approved_subscriptions %}
                    <tr>
                        <td>{{ sub.user.username }} ({{sub.user.email}})</td>
                        <td>{{ sub.service.servicename }}</td>
                        <td>{{ sub.request_date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ sub.approval_date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('adminx.manage_subscription', sub_id=sub.id, action='reject') }}" style="display:inline;" class="ms-1">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('승인된 구독을 거부하시겠습니까?');">거부</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info" role="alert">
            현재 승인된 구독이 없습니다.
        </div>
        {% endif %}
    </div>
    <div class="tab-pane fade" id="rejected" role="tabpanel" aria-labelledby="rejected-tab">
        <h2>거부된 구독</h2>
        {% if rejected_subscriptions %}
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead class="table-danger">
                    <tr>
                        <th scope="col">사용자</th>
                        <th scope="col">서비스</th>
                        <th scope="col">신청일</th>
                        <th scope="col">거부일</th>
                        <th scope="col">동작</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sub in rejected_subscriptions %}
                    <tr>
                        <td>{{ sub.user.username }} ({{sub.user.email}})</td>
                        <td>{{ sub.service.servicename }}</td>
                        <td>{{ sub.request_date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ sub.approval_date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('adminx.manage_subscription', sub_id=sub.id, action='approve') }}" style="display:inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-success btn-sm" onclick="return confirm('거부된 구독을 승인하시겠습니까?');">승인</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info" role="alert">
            현재 거부된 구독 요청이 없습니다.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
