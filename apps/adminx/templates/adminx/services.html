{# apps/adminx/templates/adminx/services.html #}
{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<h1 class="mb-4">서비스 관리</h1>

{# 검색 폼과 서비스 생성 버튼을 포함하는 하나의 행 #}
<div class="row mb-3 align-items-end"> {# align-items-end: 행 내부 요소를 아래쪽에 정렬합니다. #}
    {# 검색 폼 영역: 데스크톱에서는 9/12 컬럼, 모바일에서는 12/12 컬럼 #}
    <div class="col-md-9 col-12">
        <form action="{{ url_for('adminx.services') }}" method="GET">
            <div class="row g-2"> {# 각 검색 필드와 버튼 간의 간격(gutter)을 설정 #}
                <div class="col-md-4 col-12">
                    <input type="search" name="search" class="form-control" placeholder="서비스 이름, 설명, 키워드 검색"
                           value="{{ search_query if search_query }}" aria-label="Search">
                </div>
                <div class="col-md-2 col-6">
                    <select name="is_active" class="form-select">
                        <option value="">활성 상태</option>
                        <option value="true" {% if is_active_query == 'true' %}selected{% endif %}>활성</option>
                        <option value="false" {% if is_active_query == 'false' %}selected{% endif %}>비활성</option>
                    </select>
                </div>
                <div class="col-md-2 col-12">
                    <input type="date" name="created_at" class="form-control" placeholder="등록일"
                           value="{{ created_at_query if created_at_query }}" aria-label="Registration Date">
                </div>
                <div class="col-md-2 col-12 d-grid"> {# d-grid: 모바일에서 버튼이 부모 컬럼의 전체 너비를 차지하도록 함 #}
                    <button class="btn btn-primary" type="submit">검색</button>
                </div>
            </div>
        </form>
    </div>
    {# "서비스 생성" 버튼 영역: 데스크톱에서는 3/12 컬럼, 모바일에서는 12/12 컬럼 #}
    <div class="col-md-3 col-12 mt-2 mt-md-0 d-grid d-md-block text-md-end">
        <a href="{{ url_for('adminx.create_service') }}" class="btn btn-primary user-create-btn">서비스 생성</a>
    </div>
</div>
{% if services %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-primary">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">서비스 이름</th>
                <th scope="col">단가</th>
                <th scope="col">설명</th>
                <th scope="col">키워드</th>
                <th scope="col">엔드포인트</th>
                <th scope="col">활성 상태</th>
                <th scope="col">등록일</th>
                <th scope="col">활성화</th>
                <th scope="col">수정</th>
                <th scope="col">삭제</th>
            </tr>
        </thead>
        <tbody>
            {% for service in services %}
            <tr>
                <td>{{ service.id }}</td>
                <td>{{ service.servicename }}</td>
                <td>{{ service.price }}</td>
                <td>{{ service.description }}</td>
                <td>{{ service.keywords }}</td>
                <td>{{ service.service_endpoint }}</td>
                <td>
                    {% if service.is_active %}
                        <span class="badge bg-success">활성</span>
                    {% else %}
                        <span class="badge bg-warning text-dark">비활성</span>
                    {% endif %}
                </td>
                <td>{{ service.created_at.strftime('%Y-%m-%d') }}</td>
                <td>
                    {# 동작 컬럼: 활성화/비활성화 토글 #}
                    <form method="POST" action="{{ url_for('adminx.toggle_service_active', service_id=service.id, search=search_query, page=pagination.page, is_active=is_active_query, created_at=created_at_query) }}" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm {% if service.is_active %}btn-outline-warning{% else %}btn-outline-success{% endif %}"
                                onclick="return confirm('이 서비스의 상태를 변경하시겠습니까?');">
                            {{ '비활성화' if service.is_active else '활성화' }}
                        </button>
                    </form>
                </td>
                <td>
                    <a href="{{ url_for('adminx.edit_service', service_id=service.id) }}" class="btn btn-sm btn-info">수정</a>
                </td>
                <td>
                    <form method="POST" action="{{ url_for('adminx.delete_service', service_id=service.id, search=search_query, page=pagination.page, is_active=is_active_query, created_at=created_at_query) }}" style="display:inline;" class="ms-1">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-danger"
                                onclick="return confirm('정말로 {{ service.servicename }} 서비스를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.');">
                            삭제
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{# 페이지네이션 링크 #}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if pagination.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('adminx.services', page=pagination.prev_num, search=search_query, is_active=is_active_query, created_at=created_at_query) }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">&laquo;</span>
        </li>
        {% endif %}
        {% for p in pagination.iter_pages() %}
            {% if p %}
                {% if p == pagination.page %}
                <li class="page-item active" aria-current="page"><span class="page-link">{{ p }}</span></li>
                {% else %}
                <li class="page-item"><a class="page-link" href="{{ url_for('adminx.services', page=p, search=search_query, is_active=is_active_query, created_at=created_at_query) }}">{{ p }}</a></li>
                {% endif %}
            {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
        {% if pagination.has_next %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('adminx.services', page=pagination.next_num, search=search_query, is_active=is_active_query, created_at=created_at_query) }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a></li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">&raquo;</span></li>
        {% endif %}
    </ul></nav>
{% else %}
<div class="alert alert-info" role="alert">
    등록된 서비스가 없습니다.
</div>
{% endif %}
<style>
/* 모바일 (기본값) */
.user-create-btn {
    width: 100%; /* 모바일에서 전체 폭 */
}
/* Medium (md) 이상 화면 (768px 이상) */
@media (min-width: 768px) {
    .user-create-btn {
        width: auto; /* 데스크톱에서 내용에 맞춰 자동 크기 */
    }
}
</style>
{% endblock %}

